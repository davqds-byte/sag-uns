<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sag uns! - P2P Audio</title>
  
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

  <style>
    :root { --primary: #6c5ce7; --accent: #00b894; --bg: #f8f9fd; --danger: #ff7675; }
    body { font-family: sans-serif; background: var(--bg); text-align: center; padding: 20px; }
    .container { background: white; border-radius: 20px; padding: 25px; max-width: 450px; margin: auto; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    .hidden { display: none !important; }
    .card { border: 3px solid var(--primary); border-radius: 15px; padding: 20px; margin: 15px 0; font-size: 1.2rem; font-weight: bold; }
    button { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; margin: 5px 0; }
    .sub-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; list-style: none; padding: 0; }
    .sub-btn { border: 2px solid #eee; padding: 10px; border-radius: 10px; cursor: pointer; }
    .voted { background: var(--primary); color: white; }
    .active-reply { border-color: var(--accent); background: #e8fcf5; }
  </style>
</head>
<body>

  <h1>üó®Ô∏è Sag uns! P2P</h1>

  <div id="setup" class="container">
    <input type="text" id="userName" placeholder="Dein Name" style="width:90%; padding:10px; margin-bottom:10px;">
    <button onclick="createRoom()" style="background:var(--primary); color:white;">Raum erstellen</button>
    <input type="number" id="roomInput" placeholder="Code">
    <button onclick="joinRoom()" style="background:var(--accent); color:white;">Beitreten</button>
  </div>

  <div id="game" class="container hidden">
    <button id="muteBtn" onclick="toggleAudio()" style="background:#fdcb6e;">üé§ Audio: AN</button>
    <div id="status" style="font-size:0.8rem; color:gray; margin:10px;">Raum: <span id="roomCodeText"></span></div>
    <div id="turnInfo" style="font-weight:bold; color:var(--primary);"></div>
    <div class="card" id="questionText">---</div>
    <button id="drawBtn" class="hidden" onclick="drawNewCard()" style="background:var(--primary); color:white;">N√§chste Karte üÉè</button>
    
    <div id="votingSection" class="hidden">
        <div id="subGrid" class="sub-grid"></div>
    </div>

    <div id="answeringSection" class="hidden">
        <div id="votedList"></div>
        <button onclick="nextPlayer()" style="background:#636e72; color:white;">N√§chster Spieler ‚û°Ô∏è</button>
    </div>
  </div>

<script>
// --- CONFIG FIREBASE ---
const firebaseConfig = {
  apiKey: "AIzaSyB-80dSuUiGSK99flAzyO8cGKIUfgzT8YU",
  authDomain: "sag-uns.firebaseapp.com",
  databaseURL: "https://sag-uns-default-rtdb.firebaseio.com",
  projectId: "sag-uns",
  storageBucket: "sag-uns.firebasestorage.app",
  messagingSenderId: "336076042001",
  appId: "1:336076042001:web:3f14385ba00975b66a26b0"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// --- DATA ---
const cardsDatabase = [
    { "q": "Was ist dein Lieblingsessen aus deiner Heimat?", "sub": ["Warum?", "Wann isst du es?", "Wer kocht es?", "Tradition?", "Zu besonderen Anl√§ssen?", "Schwer zu kochen?", "Gesund?", "Vermisst du es?"] },
    { "q": "Was bedeutet Arbeit f√ºr dich?", "sub": ["Pflicht?", "Erf√ºllung?", "Geld?", "Warum?", "Identit√§t?", "Stabilit√§t?", "Stress?", "Zukunft?"] },
    { "q": "Was war dein letzter Erfolg?", "sub": ["Klein oder gro√ü?", "Wann?", "Warum wichtig?", "Gef√ºhl?", "Alleine oder im Team?", "Erwartet?", "Folgen?", "Motivierend?"] },
    { "q": "Was brauchst du zum Gl√ºcklichsein?", "sub": ["Menschen?", "Zeit?", "Gesundheit?", "Warum?", "Materiell?", "Stabil?", "Kurzfristig?", "Langfristig?"] },
    { "q": "Was war dein letzter Misserfolg?", "sub": ["Warum?", "Was gelernt?", "Heute besser?", "Wichtig?", "Emotional?", "Konsequenzen?", "Akzeptiert?", "Motivation danach?"] },
    { "q": "Was bedeutet Zuhause f√ºr dich?", "sub": ["Ort?", "Menschen?", "Gef√ºhl?", "Warum?", "Stabil?", "Kindheit?", "Heute anders?", "Zukunft?"] },
    { "q": "Was sch√§tzt du an anderen Menschen?", "sub": ["Ehrlichkeit?", "Respekt?", "Humor?", "Warum?", "Selten?", "Wichtig?", "Im Alltag?", "Beziehungen?"] },
    { "q": "Was machst du, wenn du traurig bist?", "sub": ["Alleine?", "Mit jemandem?", "Was hilft?", "Warum?", "Musik?", "Zeit?", "Sprichst du dar√ºber?", "Besser danach?"] },
    { "q": "Was m√∂chtest du einmal besitzen?", "sub": ["Warum?", "Wann?", "N√∂tig?", "Traum?", "Realistisch?", "Teuer?", "Symbolisch?", "Motivierend?"] },
    { "q": "Was ist dein Lieblingswort?", "sub": ["Warum?", "In welcher Sprache?", "Bedeutung?", "Oft benutzt?", "Gef√ºhl?", "Kurz oder lang?", "Seit wann?", "Pers√∂nlich?"] },
    { "q": "Was bedeutet Erfolg im Leben?", "sub": ["Pers√∂nlich?", "Gesellschaft?", "Geld?", "Warum?", "Zeit?", "Gesundheit?", "Balance?", "Ver√§nderlich?"] },
    { "q": "Was m√∂chtest du verbessern?", "sub": ["In dir?", "Im Alltag?", "Warum?", "Wie?", "Seit wann?", "Realistisch?", "Schritt f√ºr Schritt?", "Ziel?"] },
    { "q": "Was war dein gr√∂√üter Fehler?", "sub": ["Warum?", "Was gelernt?", "Heute anders?", "Wichtig?", "Emotional?", "Konsequenzen?", "Akzeptiert?", "Weitergeholfen?"] },
    { "q": "Was motiviert dich morgens?", "sub": ["Ziel?", "Pflicht?", "Menschen?", "Warum?", "Routine?", "Energie?", "Stimmung?", "Konstant?"] },
    { "q": "Was bedeutet Respekt f√ºr dich?", "sub": ["Warum?", "Erfahrungen?", "Wichtig?", "Im Alltag?", "Gegenseitig?", "Grenzen?", "Kultur?", "Vorleben?"] },
    { "q": "Was w√ºrdest du gerne √§ndern?", "sub": ["In deinem Leben?", "Warum?", "M√∂glich?", "Wann?", "Erster Schritt?", "Hilfe n√∂tig?", "Risiken?", "Ziel?"] },
    { "q": "Was ist dein Lieblingsmoment am Tag?", "sub": ["Warum?", "Wann?", "Mit wem?", "Gef√ºhl?", "Ruhig?", "Kurz?", "Bewusst?", "Jeden Tag?"] },
    { "q": "Was macht dich stolz?", "sub": ["Warum?", "Wann?", "Erfahrung?", "Wichtig?", "Alleine?", "Anerkennung?", "Langfristig?", "Motivierend?"] },
    { "q": "Was willst du in f√ºnf Jahren erreicht haben?", "sub": ["Warum?", "Wie?", "Mit wem?", "Realistisch?", "Beruflich?", "Privat?", "Finanziell?", "Zufriedenheit?"] },
    { "q": "Was m√∂chtest du noch erleben?", "sub": ["Warum?", "Wann?", "Mit wem?", "Traum?", "Reisen?", "Herausforderung?", "Emotional?", "Einmalig?"] },
    { "q": "Was isst du gar nicht gern?", "sub": ["Warum?", "Schon probiert?", "Immer?", "Vermeidbar?", "Kindheit?", "Geschmack?", "Geruch?", "Tolerierbar?"] },
    { "q": "Wie wichtig ist dir P√ºnktlichkeit?", "sub": ["Warum?", "Im Alltag?", "Bei Arbeit?", "Erfahrungen?", "Konsequenzen?", "Kultur?", "Stress?", "Flexibel?"] },
    { "q": "Was war dein gr√∂√üter Traum als Kind?", "sub": ["Warum?", "Erf√ºllt?", "Noch m√∂glich?", "Ge√§ndert?", "Einfluss?", "Realistisch?", "Heute wichtig?", "Gef√ºhl damals?"] },
    { "q": "Was bedeutet Erfolg f√ºr junge Menschen?", "sub": ["Heute?", "Fr√ºher?", "Unterschiede?", "Warum?", "Druck?", "Soziale Medien?", "Vergleich?", "Gesund?"] },
    { "q": "Was lernst du gerade?", "sub": ["Warum?", "Wo?", "Schwierig?", "N√ºtzlich?", "Motivation?", "Zeitaufwand?", "Ziel?", "Fortschritt?"] },
    { "q": "Was w√ºrdest du deinem j√ºngeren Ich sagen?", "sub": ["Warum?", "Erfahrung?", "Fehler?", "Rat?", "Trost?", "Warnung?", "Motivation?", "Ehrlich?"] },
    { "q": "Was ist dein Lieblingsfeiertag?", "sub": ["Warum?", "Mit wem?", "Tradition?", "Essen?", "Stimmung?", "Vorbereitung?", "Erinnerungen?", "Jedes Jahr?"] },
    { "q": "Was macht einen guten Tag aus?", "sub": ["Morgen?", "Arbeit?", "Abend?", "Warum?", "Menschen?", "Gef√ºhl?", "Erfolg?", "Ruhe?"] },
    { "q": "Wie gehst du mit Problemen um?", "sub": ["Alleine?", "Mit Hilfe?", "Sofort?", "Warum?", "Strategie?", "Erfahrung?", "Erfolg?", "Ver√§nderung?"] },
    { "q": "Was m√∂chtest du dieses Jahr lernen?", "sub": ["Warum?", "Wie?", "Wann?", "Ziel?", "Zeit?", "Motivation?", "Schwierigkeiten?", "Erfolgskriterium?"] },
    { "q": "Was machst du in deiner Freizeit?", "sub": ["Regelm√§√üig?", "Alleine?", "Mit anderen?", "Warum?", "Drinnen?", "Drau√üen?", "Zeitaufwand?", "Lieblingsaktivit√§t?"] },
    { "q": "Was w√ºrdest du nie vergessen?", "sub": ["Erlebnis?", "Person?", "Moment?", "Warum?", "Emotional?", "Lange her?", "Heute wichtig?", "Einfluss?"] },
    { "q": "Was stresst dich im Alltag?", "sub": ["Arbeit?", "Menschen?", "Zeit?", "Wie reagierst du?", "Kurzfristig?", "Langfristig?", "Kontrollierbar?", "L√∂sung?"] },
    { "q": "Wie wichtig ist Bildung f√ºr dich?", "sub": ["Warum?", "Eigene Erfahrung?", "Zukunft?", "Ziel?", "Formell?", "Informell?", "Motivation?", "Zugang?"] },
    { "q": "Was machst du, wenn du m√ºde bist?", "sub": ["Schlafen?", "Kaffee?", "Pause?", "Warum?", "Hilft?", "Kurz oder lang?", "Alltag?", "Gesund?"] },
    { "q": "Was bedeutet Freundschaft f√ºr dich?", "sub": ["Vertrauen?", "Zeit?", "Hilfe?", "Warum?", "Grenzen?", "Langfristig?", "Pflege?", "Ver√§nderung?"] },
    { "q": "Was ist dein Lieblingsfach?", "sub": ["Warum?", "Seit wann?", "N√ºtzlich?", "Schwierig?", "Lehrer?", "Praxis?", "Motivation?", "Erfolg?"] },
    { "q": "Was war dein sch√∂nster Moment?", "sub": ["Wann?", "Mit wem?", "Warum?", "Unvergesslich?", "Gef√ºhl?", "Kurz oder lang?", "Ort?", "Wiederholen?"] },
    { "q": "Was machst du bei Langeweile?", "sub": ["Handy?", "Schlafen?", "Spazieren?", "Warum?", "Alleine?", "Zeit?", "Produktiv?", "Gewohnheit?"] },
    { "q": "Was erwartest du von der Zukunft?", "sub": ["Hoffnungen?", "√Ñngste?", "Ziele?", "Warum?", "Kurzfristig?", "Langfristig?", "Realistisch?", "Optimistisch?"] },
    { "q": "Was ist dein Lieblingskleidungsst√ºck?", "sub": ["Warum?", "Wann tr√§gst du es?", "Neu oder alt?", "Bequem?", "Alltag?", "Besonders?", "Teuer?", "Gef√ºhl dabei?"] },
    { "q": "Wie planst du deinen Tag?", "sub": ["Mit Liste?", "Im Kopf?", "Spontan?", "Warum?", "Morgens?", "Abends?", "Flexibel?", "Erfolgreich?"] },
    { "q": "Was war dein letzter Fehler?", "sub": ["Was passiert?", "Was gelernt?", "Wiederholen?", "Warum?", "Klein oder gro√ü?", "Alleine?", "Konsequenzen?", "Verbessert?"] },
    { "q": "Was bedeutet Erfolg in der Arbeit?", "sub": ["Anerkennung?", "Geld?", "Spa√ü?", "Warum?", "Team?", "Ergebnisse?", "Stabilit√§t?", "Zufriedenheit?"] },
    { "q": "Was motiviert dich?", "sub": ["Ziele?", "Menschen?", "Druck?", "Warum?", "Kurzfristig?", "Langfristig?", "Stark?", "Konstant?"] },
    { "q": "Wie verbringst du Zeit alleine?", "sub": ["Gerne?", "Was machst du?", "Warum?", "Oft?", "Entspannt?", "Produktiv?", "Bewusst?", "Notwendig?"] },
    { "q": "Was war dein letzter Urlaub?", "sub": ["Wo?", "Wie lange?", "Mit wem?", "Sch√∂n?", "Entspannt?", "Aktiv?", "Kosten?", "Nochmal?"] },
    { "q": "Was w√ºrdest du neu lernen wollen?", "sub": ["Warum?", "Wann?", "Wie?", "Realistisch?", "Zeit?", "Kosten?", "Motivation?", "Ziel?"] },
    { "q": "Was ist dir im Leben am wichtigsten?", "sub": ["Warum?", "Seit wann?", "Hat sich ge√§ndert?", "Priorit√§t?", "Konflikte?", "Opfer?", "Stabil?", "Zukunft?"] },
    { "q": "Wie wichtig ist dir Ehrlichkeit?", "sub": ["Warum?", "Immer?", "Schwierig?", "Erfahrungen?", "Grenzen?", "Konsequenzen?", "Im Alltag?", "In Beziehungen?"] },
    { "q": "Wie wichtig ist Familie f√ºr dich?", "sub": ["Warum?", "Kontakt oft?", "Unterst√ºtzung?", "Zusammenhalt?", "N√§he?", "Konflikte?", "Gemeinsame Zeit?", "Zukunft?"] },
    { "q": "Was isst du zum Fr√ºhst√ºck?", "sub": ["Immer gleich?", "Gesund?", "Schnell?", "Warum?", "Alleine?", "Unter der Woche?", "Am Wochenende?", "Ohne Fr√ºhst√ºck m√∂glich?"] },
    { "q": "Was war dein letzter Kauf?", "sub": ["Was?", "Warum?", "N√∂tig?", "Teuer?", "Geplant?", "Zufrieden?", "Wieder kaufen?", "Lehre daraus?"] },
    { "q": "Was w√ºrdest du sofort √§ndern?", "sub": ["In deinem Leben?", "In der Welt?", "Warum?", "Realistisch?", "Kurzfristig?", "Langfristig?", "Alleine?", "Erste Schritte?"] },
    { "q": "Wie lernst du am besten?", "sub": ["Alleine?", "Mit Videos?", "Mit Lehrer?", "Warum?", "Zeit?", "Ort?", "Wiederholung?", "Erfolg?"] },
    { "q": "Welche Arbeit machst du gerade?", "sub": ["Seit wann?", "Gef√§llt sie dir?", "Warum?", "Zukunft?", "Stress?", "Arbeitszeit?", "Team?", "Motivation?"] },
    { "q": "Was bedeutet Freiheit f√ºr dich?", "sub": ["Zeit?", "Geld?", "Ort?", "Warum?", "Grenzen?", "Verantwortung?", "Erfahrung?", "Wichtig?"] },
    { "q": "Welche Tradition magst du?", "sub": ["Familie?", "Land?", "Feiertag?", "Warum?", "Seit wann?", "Ritual?", "Essen?", "Gef√ºhl?"] },
    { "q": "Wie wichtig ist Gesundheit f√ºr dich?", "sub": ["Sport?", "Essen?", "Vorsorge?", "Warum?", "K√∂rper?", "Geist?", "Alltag?", "Zukunft?"] },
    { "q": "Was machst du vor dem Schlafen?", "sub": ["Handy?", "Lesen?", "Musik?", "Immer gleich?", "Dauer?", "Ritual?", "Entspannend?", "Schlafqualit√§t?"] },
    { "q": "Hast du Haustiere?", "sub": ["Welche?", "Warum?", "Pflege?", "Seit wann?", "Kosten?", "Zeitaufwand?", "Alleine?", "M√∂chtest du mehr?"] },
    { "q": "Was ist dein Lieblingsort?", "sub": ["Wo?", "Warum?", "Alleine oder mit anderen?", "Oft dort?", "Drinnen oder drau√üen?", "Ruhig oder lebendig?", "Erinnerungen?", "Gef√ºhl dort?"] },
    { "q": "Wie stellst du dir dein Leben in 10 Jahren vor?", "sub": ["Job?", "Familie?", "Wohnort?", "Zufrieden?", "Finanziell?", "Gesundheit?", "Realistisch?", "Warum so?"] },
    { "q": "Was ist dein Lieblingsgetr√§nk?", "sub": ["Hei√ü oder kalt?", "Wann trinkst du es?", "Zu welchem Essen?", "Warum?", "T√§glich?", "Gesund?", "Zucker?", "Alternative?"] },
    { "q": "Was hast du zuletzt gelernt?", "sub": ["Wo?", "Warum?", "N√ºtzlich?", "Schwierig?", "Theorie oder Praxis?", "Kurz oder lang?", "Alleine?", "Nochmal lernen?"] },
    { "q": "Was machst du bei schlechtem Wetter?", "sub": ["Drinnen?", "Filme?", "Lesen?", "Schlafen?", "Produktiv?", "Entspannt?", "Alleine?", "Warum?"] },
    { "q": "Welche Eigenschaft magst du an dir?", "sub": ["Warum?", "Schon lange?", "Andere sehen das?", "Hilft im Alltag?", "In der Arbeit?", "Privat?", "Stabil?", "M√∂chtest du sie st√§rken?"] },
    { "q": "Welche Eigenschaft m√∂chtest du √§ndern?", "sub": ["Warum?", "Wie?", "Schon versucht?", "Schwierig?", "Seit wann?", "Alleine m√∂glich?", "Hilfe?", "Realistisch?"] },
    { "q": "Was macht dich gl√ºcklich?", "sub": ["Kleine Dinge?", "Menschen?", "Erfolge?", "Warum?", "Kurz oder langfristig?", "T√§glich?", "Abh√§ngig?", "Bewusst?"] },
    { "q": "Was macht dich w√ºtend?", "sub": ["Im Alltag?", "Selten oder oft?", "Wie reagierst du?", "Warum?", "Menschen?", "Situationen?", "Kontrollierbar?", "Lernbar?"] },
    { "q": "Was ist dir in Freundschaften wichtig?", "sub": ["Ehrlichkeit?", "Zeit?", "Vertrauen?", "Warum?", "Unterst√ºtzung?", "Respekt?", "Humor?", "Langfristig?"] },
    { "q": "Hast du ein Vorbild?", "sub": ["Wer?", "Warum?", "Pers√∂nlich oder bekannt?", "Seit wann?", "Was bewunderst du?", "√Ñhnlich wie du?", "Motivierend?", "Realistisch?"] },
    { "q": "Was machst du morgens zuerst?", "sub": ["Handy?", "Fr√ºhst√ºck?", "Sport?", "Warum?", "Immer gleich?", "Unter der Woche?", "Am Wochenende?", "Hilfreich?"] },
    { "q": "Was kannst du gar nicht leiden?", "sub": ["Warum?", "Seit wann?", "Im Alltag?", "Vermeidbar?", "Menschen oder Dinge?", "Stark oder leicht?", "Reaktion?", "Konsequenzen?"] },
    { "q": "Welche Jahreszeit magst du am meisten?", "sub": ["Warum?", "Was machst du dann?", "Reisen?", "Essen?", "Temperatur?", "Erinnerungen?", "Stimmung?", "Kleidung?"] },
    { "q": "Wie verbringst du deine Abende?", "sub": ["Alleine?", "Mit Medien?", "Mit Familie?", "Entspannt oder aktiv?", "Immer gleich?", "Wochentage?", "Zeitpunkt?", "Warum so?"] },
    { "q": "Was bedeutet Erfolg f√ºr dich?", "sub": ["Geld?", "Zufriedenheit?", "Anerkennung?", "Warum?", "Privat oder beruflich?", "Kurzfristig?", "Langfristig?", "Messbar?"] },
    { "q": "Welche Arbeit w√ºrdest du nie machen?", "sub": ["Warum?", "Zu schwer?", "Zu langweilig?", "Zu gef√§hrlich?", "Schon erlebt?", "Geld egal?", "Stressig?", "Grenzen?"] },
    { "q": "Wie wichtig ist Geld f√ºr dich?", "sub": ["Sehr?", "Wof√ºr?", "Sparen?", "Teilen?", "Sicherheit?", "Freiheit?", "Stress?", "Genug?"] },
    { "q": "Was machst du am Handy am meisten?", "sub": ["Social Media?", "Videos?", "Nachrichten?", "Wie lange?", "N√ºtzlich?", "Ablenkung?", "Abends?", "M√∂chtest du √§ndern?"] },
    { "q": "Welche Musik h√∂rst du am liebsten?", "sub": ["Welche Art?", "Alleine oder mit Freunden?", "Beim Arbeiten?", "Warum diese Musik?", "Lieblingsk√ºnstler?", "Seit wann?", "Laut oder leise?", "Jeden Tag?"] },
    { "q": "Spielst du ein Instrument?", "sub": ["Welches?", "Seit wann?", "Selbst gelernt?", "Wie oft?", "Schwer?", "Alleine oder mit anderen?", "M√∂chtest du besser werden?", "Warum dieses Instrument?"] },
    { "q": "Was machst du, wenn du Stress hast?", "sub": ["Hilft es?", "Wie oft?", "Alleine?", "Gesund oder ungesund?", "Kurz oder lange?", "Schon lange so?", "Alternative?", "Warum das?"] },
    { "q": "Welche App benutzt du jeden Tag?", "sub": ["Warum?", "Wie lange t√§glich?", "Ohne sie m√∂glich?", "Seit wann?", "Privat oder Arbeit?", "N√ºtzlich?", "Zeitfresser?", "Lieblingsfunktion?"] },
    { "q": "Was ist dein Lieblingsfilm?", "sub": ["Genre?", "Wann zuletzt gesehen?", "Mit wem?", "Warum dieser Film?", "Alt oder neu?", "Mehrmals gesehen?", "Emotionen?", "Empfehlung?"] },
    { "q": "Treibst du Sport?", "sub": ["Welche Sportart?", "Wie oft?", "Alleine oder im Team?", "Seit wann?", "Drinnen oder drau√üen?", "Warum?", "Gesund?", "Ziel?"] },
    { "q": "Was war dein gr√∂√üter Erfolg?", "sub": ["Wann?", "Wie hast du dich gef√ºhlt?", "War es schwer?", "Was hast du gelernt?", "Alleine geschafft?", "Beruflich oder privat?", "Warum wichtig?", "Stolz?"] },
    { "q": "Was war deine gr√∂√üte Herausforderung?", "sub": ["Warum schwierig?", "Wie gel√∂st?", "Alleine?", "Heute anders?", "Lange gedauert?", "Stressig?", "Was gelernt?", "Wichtig f√ºr dich?"] },
    { "q": "Welche Sprache m√∂chtest du lernen?", "sub": ["Warum?", "Wie lernst du?", "Schwer?", "Schon angefangen?", "F√ºr Arbeit?", "F√ºr Reisen?", "Wie oft √ºbst du?", "Zielniveau?"] },
    { "q": "Wie sieht dein perfekter tag aus?", "sub": ["Morgen?", "Mittag?", "Abend?", "Mit wem?", "Arbeit oder frei?", "Drinnen oder drau√üen?", "Realistisch?", "Warum perfekt?"] },
    { "q": "Was ist dein absolutes Lieblingsessen?", "sub": ["Selbst gekocht?", "Bestes Restaurant?", "Wie oft isst du das?", "Warum genau das?", "S√º√ü oder salzig?", "Gesund oder ungesund?", "Seit wann?", "Mit wem isst du es gern?"] },
    { "q": "Was machst du am liebsten am Wochenende?", "sub": ["Mit wem?", "Drinnen oder drau√üen?", "Seit wann?", "Kostet das viel Geld?", "Samstag oder Sonntag?", "Entspannt oder aktiv?", "Alleine m√∂glich?", "Warum genau das?"] },
    { "q": "Erz√§hl uns von deinem Traumjob.", "sub": ["Welches Gehalt?", "Warum dieser Beruf?", "Was musst du daf√ºr lernen?", "Wo arbeitest du dann?", "Vollzeit oder Teilzeit?", "Im team?", "Stressig?", "Ab wann realistisch?"] },
    { "q": "Welches Land m√∂chtest du unbedingt bereisen?", "sub": ["Warum dorthin?", "Mit wem?", "Was willst du dort essen?", "Wie lange bleiben?", "Stadt oder Natur?", "Teuer?", "Alleine m√∂glich?", "Wann?"] },
    { "q": "Was war dein sch√∂nster Urlaub bisher?", "sub": ["Wann war das?", "Was war das Highlight?", "War es teuer?", "W√ºrdest du nochmal hin?", "Mit wem?", "Wie lange?", "Entspannt oder aktiv?", "Warum so besonders?"] },
    { "q": "Hast du ein besonderes Talent?", "sub": ["Wie hast du es gemerkt?", "√úbst du viel?", "Kannst du es uns zeigen?", "Haben andere das auch?", "Seit wann?", "N√ºtzlich?", "Beruflich?", "M√∂chtest du es verbessern?"] },
    { "q": "Was ist deine fr√ºheste Kindheitserinnerung?", "sub": ["Wie alt warst du?", "Wer war dabei?", "War es ein gl√ºcklicher Moment?", "Wo war das?", "Klar oder verschwommen?", "Oft daran gedacht?", "Warum geblieben?", "Gef√ºhl heute?"] },
    { "q": "Welches Buch hat dich beeindruckt?", "sub": ["Worum geht es?", "Wem w√ºrdest du es schenken?", "Gibt es einen Film dazu?", "Warum dieses?", "Leicht zu lesen?", "Alt oder neu?", "Nochmals lesen?", "Was gelernt?"] },
    { "q": "Bist du ein Morgenmensch oder eine Nachteule?", "sub": ["Warum?", "Wann stehst du auf?", "Was machst du nachts?", "Wann bist du produktiv?", "Schon immer so?", "Arbeit angepasst?", "Problematisch?", "M√∂chtest du es √§ndern?"] },
    { "q": "Was ist dein wichtigstes Ziel f√ºr dieses Jahr?", "sub": ["Wie planst du das?", "Wer hilft dir?", "Was passiert, wenn du es schaffst?", "Ist es schwer?", "Warum dieses Ziel?", "Zeitplan?", "Risiken?", "Motivation?"] }
]


// --- STATE ---
let gameId, myName, players = [], currentTurnIndex = 0;
let myPeer, localStream, isMuted = false;

// --- MULTIPLAYER LOGIC ---
function createRoom() {
    myName = document.getElementById("userName").value.trim();
    if(!myName) return alert("Gib deinen Namen ein!");
    gameId = Math.floor(1000 + Math.random() * 9000).toString();
    database.ref('rooms/' + gameId).set({
        players: [myName], currentTurnIndex: 0,
        currentCard: { q: "Startbereit!", sub: [] },
        votedSubs: {}, activeSubReply: -1
    }).then(showGame);
}

function joinRoom() {
    myName = document.getElementById("userName").value.trim();
    gameId = document.getElementById("roomInput").value;
    const ref = database.ref('rooms/' + gameId);
    ref.once('value', s => {
        if(s.exists()) {
            let p = s.val().players || [];
            if(!p.includes(myName)) p.push(myName);
            ref.update({ players: p }).then(showGame);
        } else alert("Raum nicht gefunden!");
    });
}

function showGame() {
    document.getElementById("setup").classList.add("hidden");
    document.getElementById("game").classList.remove("hidden");
    document.getElementById("roomCodeText").innerText = gameId;
    setupAudio(gameId);
    listenToRoom();
}

// --- P2P AUDIO LOGIC ---
function setupAudio(roomCode) {
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        localStream = stream;
        myPeer = new Peer("SU-" + roomCode + "-" + myName.replace(/\s+/g, ''));

        myPeer.on('call', call => {
            call.answer(localStream);
            call.on('stream', remoteStream => playStream(remoteStream));
        });

        // Appeler les autres
        database.ref('rooms/' + gameId + '/players').once('value', s => {
            s.val().forEach(pName => {
                if(pName !== myName) {
                    const call = myPeer.call("SU-" + roomCode + "-" + pName.replace(/\s+/g, ''), localStream);
                    call.on('stream', remoteStream => playStream(remoteStream));
                }
            });
        });
    }).catch(() => alert("Zugriff auf Mikrofon verweigert."));
}

function playStream(stream) {
    const audio = document.createElement('audio');
    audio.srcObject = stream;
    audio.autoplay = true;
    document.body.appendChild(audio);
}

function toggleAudio() {
    isMuted = !isMuted;
    localStream.getAudioTracks()[0].enabled = !isMuted;
    const btn = document.getElementById("muteBtn");
    btn.innerText = isMuted ? "üîá Audio: AUS" : "üé§ Audio: AN";
    btn.style.background = isMuted ? "var(--danger)" : "#fdcb6e";
}

// --- SYNC LOGIC ---
function listenToRoom() {
    database.ref('rooms/' + gameId).on('value', s => {
        const data = s.val();
        players = data.players;
        currentTurnIndex = data.currentTurnIndex;
        const activePlayer = players[currentTurnIndex];
        const isMyTurn = (activePlayer === myName);

        document.getElementById("turnInfo").innerText = isMyTurn ? "Du bist dran!" : activePlayer + " antwortet...";
        document.getElementById("questionText").innerText = data.currentCard.q;
        document.getElementById("drawBtn").classList.toggle("hidden", !isMyTurn);

        if(isMyTurn) {
            document.getElementById("votingSection").classList.add("hidden");
            document.getElementById("answeringSection").classList.remove("hidden");
            renderAnsweringList(data.currentCard.sub || [], data.votedSubs || {}, data.activeSubReply);
        } else {
            document.getElementById("votingSection").classList.remove("hidden");
            document.getElementById("answeringSection").classList.add("hidden");
            renderVotingGrid(data.currentCard.sub || [], data.votedSubs || {});
        }

        // Donner la priorit√© audio au joueur actif
        if(localStream) {
            localStream.getAudioTracks()[0].enabled = isMyTurn;
            document.getElementById("muteBtn").innerText = isMyTurn ? "üé§ Audio: AN" : "üîá Audio: AUS";
        }
    });
}

function drawNewCard() {
    const card = cardsDatabase[Math.floor(Math.random() * cardsDatabase.length)];
    database.ref('rooms/' + gameId).update({ currentCard: card, votedSubs: {}, activeSubReply: -1 });
}

function renderVotingGrid(subs, votedSubs) {
    const grid = document.getElementById("subGrid"); grid.innerHTML = "";
    subs.forEach((text, i) => {
        const btn = document.createElement("div");
        btn.className = "sub-btn" + (votedSubs[i] === myName ? " voted" : "");
        btn.innerText = text;
        btn.onclick = () => {
            const up = {}; up[`votedSubs/${i}`] = myName;
            database.ref('rooms/' + gameId).update(up);
        };
        grid.appendChild(btn);
    });
}

function renderAnsweringList(subs, votedSubs, activeReply) {
    const list = document.getElementById("votedList"); list.innerHTML = "";
    Object.keys(votedSubs).forEach(k => {
        const i = parseInt(k);
        const div = document.createElement("div");
        div.className = "card" + (activeReply === i ? " active-reply" : "");
        div.innerText = subs[i] + " (Votiert von " + votedSubs[i] + ")";
        div.onclick = () => database.ref('rooms/' + gameId).update({ activeSubReply: i });
        list.appendChild(div);
    });
}

function nextPlayer() {
    const nextIdx = (currentTurnIndex + 1) % players.length;
    database.ref('rooms/' + gameId).update({ currentTurnIndex: nextIdx, votedSubs: {}, activeSubReply: -1 });
}
</script>
</body>
</html>
